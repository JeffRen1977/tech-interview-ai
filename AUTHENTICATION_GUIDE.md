# AI面试教练 - 用户认证系统指南

## 🚀 功能概述

本项目已实现完整的用户认证系统，包括：

- ✅ 用户注册和登录
- ✅ JWT Token认证
- ✅ 用户角色管理（普通用户/管理员）
- ✅ 权限控制
- ✅ 用户资料管理
- ✅ 安全的密码处理

## 👥 用户角色

### 普通用户 (user)
- 可以访问所有学习功能
- 编程练习、模拟面试、简历优化
- AI教练、学习反馈、用户历史
- 无法访问管理后台

### 管理员 (admin)
- 拥有普通用户的所有权限
- 可以访问管理后台
- 可以生成和管理题库
- 可以查看系统统计

## 🔐 默认管理员账户

为了方便测试，系统已预创建一个管理员账户：

```
邮箱: admin@aiinterview.com
密码: admin123456
角色: admin
```

## 📝 用户注册

### 注册要求
- 邮箱地址（必须是有效格式）
- 密码（至少6位字符）
- 姓名
- 确认密码（必须与密码一致）

### 注册流程
1. 访问首页
2. 点击"登录/注册"按钮
3. 在登录页面点击"注册"切换到注册模式
4. 填写所有必填字段
5. 点击"注册"按钮

## 🔑 用户登录

### 登录流程
1. 访问首页
2. 点击"登录/注册"按钮
3. 输入邮箱和密码
4. 点击"登录"按钮

### 登录状态保持
- 登录成功后，系统会保存JWT Token到本地存储
- Token有效期为7天
- 刷新页面会自动检查登录状态
- Token过期后会自动跳转到登录页面

## 🛡️ 权限控制

### 前端权限控制
- 只有管理员用户才能看到"管理后台"菜单项
- 普通用户尝试访问管理页面会被重定向
- 用户信息在侧边栏显示，包括角色标识

### 后端权限控制
- 所有API请求都需要有效的JWT Token
- 管理员功能需要额外的管理员权限验证
- 未授权访问会返回401或403错误

## 🔧 API认证

### 请求头格式
```javascript
headers: {
  'Content-Type': 'application/json',
  'Authorization': 'Bearer <your-jwt-token>'
}
```

### 认证中间件
- `verifyToken`: 验证用户是否已登录
- `verifyAdmin`: 验证用户是否具有管理员权限

## 📊 用户数据

### 用户信息结构
```javascript
{
  uid: "用户ID",
  email: "邮箱地址",
  name: "用户姓名",
  role: "用户角色", // "user" 或 "admin"
  createdAt: "创建时间",
  lastLogin: "最后登录时间",
  profile: {
    targetCompanies: ["目标公司"],
    techStacks: ["技术栈"],
    language: "语言偏好",
    availableTime: "可用时间",
    otherPreferences: "其他偏好"
  }
}
```

### 本地存储
- `token`: JWT认证令牌
- `user`: 用户基本信息

## 🚪 退出登录

### 退出流程
1. 点击侧边栏底部的"退出登录"按钮
2. 系统会清除本地存储的认证信息
3. 自动跳转到首页

### 安全考虑
- 退出时会清除所有认证数据
- 下次访问需要重新登录
- 服务器端Token仍然有效，但客户端无法使用

## 🔒 安全特性

### 密码安全
- 密码在传输前进行加密
- 密码长度验证（最少6位）
- 密码确认验证

### Token安全
- JWT Token包含用户ID、邮箱和角色信息
- Token有效期限制（7天）
- Token过期自动处理

### 权限验证
- 前端和后端双重权限验证
- 管理员功能严格限制
- API访问权限控制

## 🛠️ 开发说明

### 创建新管理员
```bash
cd backend
node createAdmin.js
```

### 环境变量
```env
JWT_SECRET=your-secret-key-here
```

### 添加新的受保护路由
```javascript
// 需要用户登录
router.get('/protected-route', verifyToken, yourController);

// 需要管理员权限
router.post('/admin-route', verifyToken, verifyAdmin, yourController);
```

## 📱 使用流程

### 新用户流程
1. 访问首页
2. 点击"开始准备"或"登录/注册"
3. 选择"注册"模式
4. 填写注册信息
5. 注册成功后自动登录
6. 开始使用AI面试教练功能

### 现有用户流程
1. 访问首页
2. 点击"登录/注册"
3. 输入邮箱和密码
4. 登录成功后进入仪表板
5. 使用各种学习功能

### 管理员流程
1. 使用管理员账户登录
2. 在侧边栏可以看到"管理后台"选项
3. 点击进入管理后台
4. 管理题库和系统设置

## 🐛 故障排除

### 常见问题

**Q: 登录失败怎么办？**
A: 检查邮箱和密码是否正确，确保网络连接正常。

**Q: 看不到管理后台菜单？**
A: 确认当前用户具有管理员权限，检查用户角色是否为"admin"。

**Q: Token过期怎么办？**
A: 系统会自动跳转到登录页面，重新登录即可。

**Q: 注册时提示用户已存在？**
A: 该邮箱已被注册，请使用其他邮箱或直接登录。

### 调试信息
- 浏览器控制台会显示详细的API请求信息
- 后端日志会记录认证相关的错误信息
- 网络面板可以查看请求头和响应状态

## 📞 技术支持

如果遇到认证相关的问题，请检查：
1. 网络连接是否正常
2. 后端服务器是否运行
3. Firebase配置是否正确
4. 浏览器控制台是否有错误信息 